{"title":"Mango Rekt","markdown":{"yaml":{"title":"Mango Rekt","description":"Mango got Rekt by Market Manipulation on October 11, 2022","page-layout":"full"},"headingText":"Overview","containsRefs":false,"markdown":"\n\n\nOn October 11th, 2022, [Avraham Eisenberg](https://twitter.com/avi_eisen) and co conducted a [\"highly profitable trade\"](https://twitter.com/avi_eisen/status/1581326197241180160?s=20&t=a5u1dtV_DRe8Nl4p58N0_w), exploiting a poor liquidation implementation on [Mango Markets](https://mango.markets/), a DeFi application on the Solana network.\n\n## How it worked\n\nAttacker had two accounts, let's call them account A and account B.\n\n1. Attacker funds account A with $5 million of USDC, to be used as collateral for on-chain positions.\n\n2. Attacker then offered out (sold short) ~483 million MNGO tokens, trading at $0.038 at the time.\n\n3. Attacker then funds account B with $5 million USDC, and purchases those ~438 million MNGO at $0.0382\n\n4. Attacker then purchases MNGO on the Spot market, artificially increasing its price. The price of mango reached $0.91 (a 24x increase).\n\n5. At this new inflated price, account B was in the money for ~ $423 million. He used this account value to take out a loan of $116 million consisting of several tokens.\n\n6. After the attack, the MNGO/USD spot market then traded down to $0.02, which put account A in the money. However, Mango protocol was effectively drained of all liquidity, so account A could not be paid out.\n\n## Summary\n\nMango Markets were designed to give loans at a certain collateralization ratio (e.g. 400%), but they used the spot market as an oracle for \"fair price\" of the token. Thus, tokens with low liquidity could be easily manipulated such that the protocol believes \"fair price\" is multiples above what anyone would purchase the token at in free markets.\n\n## Future Mitigation\n\nMitigating this type of attack is as simple as fixing the Oracle mechanism. For example, one could use a 24hr rolling average price to determine \"fair value\" for lending, which would make the market manipulator's attack much more difficult (must pump price for 24 hour rather than a few seconds).\n\n## Credits & Commentary\n\n- [Notice of Exploit by Otter Security](https://twitter.com/osec_io/status/1579969927020412929?s=20&t=AK8-AGc9O6k-Rfb1HSegXw)\n\n- [Early Analysis of What Happened](https://twitter.com/joshua_j_lim/status/1579987648546246658?s=20&t=AK8-AGc9O6k-Rfb1HSegXw)\n\n- [Sam Bankman Freid on How to Protect from this Attack](https://twitter.com/SBF_FTX/status/1580170203664904195?s=20&t=OFZtV7pNaQTj5BvE_yCdDw)\n\n- [Attacker Admitting his Involvement](https://twitter.com/avi_eisen/status/1581326197241180160?s=20&t=a5u1dtV_DRe8Nl4p58N0_w)\n","srcMarkdownNoYaml":"\n\n## Overview\n\nOn October 11th, 2022, [Avraham Eisenberg](https://twitter.com/avi_eisen) and co conducted a [\"highly profitable trade\"](https://twitter.com/avi_eisen/status/1581326197241180160?s=20&t=a5u1dtV_DRe8Nl4p58N0_w), exploiting a poor liquidation implementation on [Mango Markets](https://mango.markets/), a DeFi application on the Solana network.\n\n## How it worked\n\nAttacker had two accounts, let's call them account A and account B.\n\n1. Attacker funds account A with $5 million of USDC, to be used as collateral for on-chain positions.\n\n2. Attacker then offered out (sold short) ~483 million MNGO tokens, trading at $0.038 at the time.\n\n3. Attacker then funds account B with $5 million USDC, and purchases those ~438 million MNGO at $0.0382\n\n4. Attacker then purchases MNGO on the Spot market, artificially increasing its price. The price of mango reached $0.91 (a 24x increase).\n\n5. At this new inflated price, account B was in the money for ~ $423 million. He used this account value to take out a loan of $116 million consisting of several tokens.\n\n6. After the attack, the MNGO/USD spot market then traded down to $0.02, which put account A in the money. However, Mango protocol was effectively drained of all liquidity, so account A could not be paid out.\n\n## Summary\n\nMango Markets were designed to give loans at a certain collateralization ratio (e.g. 400%), but they used the spot market as an oracle for \"fair price\" of the token. Thus, tokens with low liquidity could be easily manipulated such that the protocol believes \"fair price\" is multiples above what anyone would purchase the token at in free markets.\n\n## Future Mitigation\n\nMitigating this type of attack is as simple as fixing the Oracle mechanism. For example, one could use a 24hr rolling average price to determine \"fair value\" for lending, which would make the market manipulator's attack much more difficult (must pump price for 24 hour rather than a few seconds).\n\n## Credits & Commentary\n\n- [Notice of Exploit by Otter Security](https://twitter.com/osec_io/status/1579969927020412929?s=20&t=AK8-AGc9O6k-Rfb1HSegXw)\n\n- [Early Analysis of What Happened](https://twitter.com/joshua_j_lim/status/1579987648546246658?s=20&t=AK8-AGc9O6k-Rfb1HSegXw)\n\n- [Sam Bankman Freid on How to Protect from this Attack](https://twitter.com/SBF_FTX/status/1580170203664904195?s=20&t=OFZtV7pNaQTj5BvE_yCdDw)\n\n- [Attacker Admitting his Involvement](https://twitter.com/avi_eisen/status/1581326197241180160?s=20&t=a5u1dtV_DRe8Nl4p58N0_w)\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"markdown"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../../../../styles.css"],"output-file":"mango.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.433","theme":"simplex","categories":["crypto","solana"],"title":"Mango Rekt","description":"Mango got Rekt by Market Manipulation on October 11, 2022","page-layout":"full"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}